DEFGATE X:
    0, 1
    1, 0

DEFGATE CNOT:
    1, 0, 0, 0
    0, 1, 0, 0
    0, 0, 0, 1
    0, 0, 1, 0

DEFGATE U(%theta, %phi, %lambda):
    EXP(-i*(%phi+%lambda)/2)*COS(%theta/2), -EXP(-i*(%phi-%lambda)/2)*SIN(%theta/2)
    EXP(i*(%phi-%lambda)/2)*SIN(%theta/2), EXP(i*(%phi+%lambda)/2)*COS(%theta/2)

DEFCIRCUIT CLEAR q scratch_bit:
    MEASURE q scratch_bit
    JUMP-UNLESS @end scratch_bit
    X q
    LABEL @end

DECLARE result BIT[4]
U(pi, 0, pi) 13
U(pi, 0, pi) 0
U(pi, 0, pi) 15
U(pi, 0, pi) 4
CNOT 8 9
CNOT 9 10
CNOT 10 11
CNOT 11 12
CNOT 10 11
CNOT 9 10
CNOT 8 9
CNOT 15 8
CNOT 8 9
CNOT 9 10
CNOT 10 11
CNOT 11 12
CNOT 10 11
CNOT 9 10
CNOT 8 9
CNOT 15 8
CNOT 13 12
U(pi/2, 0, pi) 14
U(0, 0, 0.785398) 14
CNOT 15 14
U(0, 0, -0.785398) 14
CNOT 13 14
U(0, 0, 0.785398) 14
CNOT 15 14
U(0, 0, -0.785398) 14
CNOT 13 14
U(pi/2, 0, pi) 14
CNOT 13 12
CNOT 12 11
CNOT 11 10
CNOT 10 9
CNOT 11 10
CNOT 12 11
CNOT 13 12
CNOT 14 13
CNOT 13 12
CNOT 12 11
CNOT 11 10
CNOT 10 9
CNOT 11 10
CNOT 12 11
CNOT 13 12
CNOT 14 13
CNOT 0 1
CNOT 1 2
CNOT 2 13
CNOT 13 12
CNOT 12 11
CNOT 11 10
CNOT 10 9
CNOT 11 10
CNOT 12 11
CNOT 13 12
CNOT 2 13
CNOT 1 2
CNOT 0 1
CNOT 7 0
CNOT 0 1
CNOT 1 2
CNOT 2 13
CNOT 13 12
CNOT 12 11
CNOT 11 10
CNOT 10 9
CNOT 11 10
CNOT 12 11
CNOT 13 12
CNOT 2 13
CNOT 1 2
CNOT 0 1
CNOT 7 0
CNOT 1 2
CNOT 2 13
CNOT 13 12
CNOT 12 11
CNOT 11 10
CNOT 10 9
CNOT 11 10
CNOT 12 11
CNOT 13 12
CNOT 2 13
CNOT 1 2
CNOT 0 1
CNOT 1 2
CNOT 2 13
CNOT 13 12
CNOT 12 11
CNOT 11 10
CNOT 10 9
CNOT 11 10
CNOT 12 11
CNOT 13 12
CNOT 2 13
CNOT 1 2
CNOT 0 1
U(pi/2, 0, pi) 1
U(0, 0, 1.5708) 14
U(0, 0, -1.5708) 7
U(0, 0, 1.5708) 0
U(0, 0, -0.785398) 1
CNOT 14 1
U(0, 0, -1.5708) 1
CNOT 0 1
CNOT 7 0
CNOT 0 1
U(0, 0, 0.785398) 1
CNOT 14 1
U(0, 0, 1.5708) 1
CNOT 0 1
U(0, 0, -1.5708) 1
CNOT 14 1
U(0, 0, 0.785398) 1
CNOT 0 1
CNOT 14 1
CNOT 7 0
CNOT 0 1
U(0, 0, 0.785398) 1
CNOT 0 1
CNOT 7 0
CNOT 0 1
CNOT 7 0
CNOT 0 1
U(pi/2, 0, pi) 1
CNOT 12 11
CNOT 11 10
CNOT 12 11
CNOT 13 12
CNOT 12 11
CNOT 11 10
CNOT 12 11
CNOT 13 12
CNOT 11 10
CNOT 12 11
CNOT 11 10
CNOT 12 11
CNOT 11 10
CNOT 3 2
CNOT 2 13
CNOT 13 12
CNOT 12 11
CNOT 11 10
CNOT 12 11
CNOT 13 12
CNOT 2 13
CNOT 3 2
CNOT 4 3
CNOT 3 2
CNOT 2 13
CNOT 13 12
CNOT 12 11
CNOT 11 10
CNOT 12 11
CNOT 13 12
CNOT 2 13
CNOT 3 2
CNOT 4 3
CNOT 1 2
CNOT 2 13
CNOT 13 12
CNOT 12 11
CNOT 11 10
CNOT 12 11
CNOT 13 12
CNOT 2 13
CNOT 1 2
U(pi/2, 0, pi) 3
U(0, 0, -1.5708) 4
U(0, 0, 1.5708) 2
U(0, 0, 1.5708) 1
U(0, 0, -0.785398) 3
CNOT 4 3
U(0, 0, 1.5708) 3
CNOT 2 3
U(0, 0, 0.785398) 3
CNOT 4 3
U(0, 0, -1.5708) 3
CNOT 2 3
CNOT 1 2
CNOT 2 3
U(0, 0, 0.785398) 3
CNOT 1 2
CNOT 2 3
U(0, 0, -1.5708) 3
CNOT 4 3
U(0, 0, 0.785398) 3
CNOT 4 3
CNOT 2 3
CNOT 1 2
CNOT 2 3
CNOT 1 2
U(pi/2, 0, pi) 3
CNOT 2 3
CNOT 3 4
CNOT 4 5
CNOT 5 6
CNOT 4 5
CNOT 3 4
CNOT 2 3
CNOT 9 10
CNOT 10 11
CNOT 11 12
CNOT 12 13
CNOT 13 2
CNOT 2 3
CNOT 3 4
CNOT 4 5
CNOT 5 6
CNOT 4 5
CNOT 3 4
CNOT 2 3
CNOT 13 2
CNOT 12 13
CNOT 11 12
CNOT 10 11
CNOT 9 10
CNOT 2 3
CNOT 3 4
CNOT 4 5
CNOT 5 6
CNOT 4 5
CNOT 3 4
CNOT 2 3
CNOT 8 9
CNOT 9 10
CNOT 10 11
CNOT 11 12
CNOT 12 13
CNOT 13 2
CNOT 2 3
CNOT 3 4
CNOT 4 5
CNOT 5 6
CNOT 4 5
CNOT 3 4
CNOT 2 3
CNOT 13 2
CNOT 12 13
CNOT 11 12
CNOT 10 11
CNOT 9 10
CNOT 8 9
CNOT 5 6
CNOT 4 5
CNOT 5 6
CNOT 4 5
CNOT 3 4
CNOT 4 5
CNOT 5 6
CNOT 4 5
CNOT 3 4
U(pi/2, 0, pi) 3
U(0, 0, -1.5708) 4
U(0, 0, -0.785398) 3
CNOT 4 3
U(0, 0, 1.5708) 3
U(0, 0, 1.5708) 2
CNOT 3 2
CNOT 4 3
CNOT 3 2
U(0, 0, -1.5708) 2
CNOT 3 2
U(0, 0, 0.785398) 2
CNOT 3 2
CNOT 4 3
CNOT 3 2
U(0, 0, -1.5708) 2
U(0, 0, 1.5708) 1
CNOT 2 1
CNOT 3 2
CNOT 4 3
CNOT 3 2
CNOT 2 1
U(0, 0, -1.5708) 1
CNOT 2 1
CNOT 3 2
CNOT 2 1
U(0, 0, 0.785398) 1
CNOT 2 1
CNOT 3 2
CNOT 4 3
CNOT 3 2
CNOT 2 1
U(0, 0, -1.5708) 1
CNOT 2 1
U(0, 0, 0.785398) 1
CNOT 2 1
CNOT 4 3
CNOT 3 2
CNOT 2 1
U(0, 0, -1.5708) 1
CNOT 3 2
CNOT 2 1
U(pi/2, 0, pi) 3
U(pi/2, 0, pi) 1
U(0, 0, 1.5708) 14
U(0, 0, -1.5708) 7
CNOT 0 7
CNOT 1 0
CNOT 14 1
CNOT 1 0
CNOT 0 7
U(0, 0, -1.5708) 7
U(0, 0, -1.5708) 1
CNOT 14 1
U(0, 0, -0.785398) 1
CNOT 0 1
CNOT 7 0
CNOT 0 1
U(0, 0, 0.785398) 1
CNOT 14 1
U(0, 0, 1.5708) 1
U(0, 0, -1.5708) 0
CNOT 7 0
U(0, 0, -1.5708) 0
CNOT 1 0
CNOT 14 1
CNOT 1 0
U(0, 0, 1.5708) 0
CNOT 14 1
CNOT 1 0
U(0, 0, 0.785398) 0
CNOT 7 0
U(0, 0, 0.785398) 0
CNOT 1 0
CNOT 14 1
CNOT 1 0
U(0, 0, -1.5708) 0
CNOT 1 0
CNOT 0 7
CNOT 1 0
CNOT 14 1
CNOT 1 0
CNOT 0 7
CNOT 1 0
CNOT 0 1
CNOT 7 0
CNOT 0 1
CNOT 7 0
CNOT 1 0
U(pi/2, 0, pi) 1
U(pi/2, 0, pi) 14
U(0, 0, 1.5708) 15
U(0, 0, 0.785398) 14
CNOT 15 14
U(0, 0, -0.785398) 14
U(0, 0, 1.5708) 13
CNOT 12 13
CNOT 11 12
CNOT 10 11
CNOT 9 10
CNOT 8 9
CNOT 15 8
CNOT 8 9
CNOT 9 10
CNOT 10 11
CNOT 11 12
CNOT 12 13
U(0, 0, -1.5708) 13
CNOT 14 13
U(0, 0, -0.785398) 13
CNOT 12 13
CNOT 11 12
CNOT 10 11
CNOT 9 10
CNOT 8 9
CNOT 15 8
CNOT 8 9
CNOT 9 10
CNOT 10 11
CNOT 11 12
CNOT 12 13
U(0, 0, 0.785398) 13
CNOT 8 9
CNOT 9 10
CNOT 10 11
CNOT 11 12
CNOT 12 13
CNOT 11 12
CNOT 10 11
CNOT 9 10
CNOT 8 9
CNOT 15 8
CNOT 8 9
CNOT 9 10
CNOT 10 11
CNOT 11 12
CNOT 12 13
CNOT 15 14
CNOT 11 12
CNOT 10 11
CNOT 9 10
CNOT 8 9
CNOT 15 8
CNOT 14 13
U(pi/2, 0, pi) 14
MEASURE 12 result[0]
MEASURE 9 result[1]
MEASURE 10 result[2]
MEASURE 6 result[3]
