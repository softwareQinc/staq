file(GLOB FILENAMES *.cpp)

add_custom_target(tools COMMENT "Build all binary tools.")

set(BUILD_GRID_SYNTH OFF)
if (MSVC)
    MESSAGE(STATUS "MSVC")
    find_package(PkgConfig)
    if (PkgConfig_FOUND)
        # gmp, gmpxx
        pkg_search_module(GMP gmp)
        pkg_search_module(GMPXX gmpxx)
        if (GMP_FOUND AND GMMXX_FOUND)
            set(BUILD_GRID_SYNTH ON)
            add_compile_options("-DEXPR_GMP")
        endif ()
    endif ()
else ()
    MESSAGE(STATUS "NOT MSVC")
    find_package(GMP)
    if (GMP_FOUND)
        set(BUILD_GRID_SYNTH ON)
        add_compile_options("-DEXPR_GMP")
    endif ()
endif ()

foreach (filename ${FILENAMES})
    get_filename_component(basename ${filename} NAME_WE)
    if (${BUILD_GRID_SYNTH})
        add_executable("staq_${basename}" ${filename})
        if (MSVC)
            target_link_libraries(staq_${basename} PUBLIC PkgConfig::gmp PkgConfig::gmpxx)
        else ()
            target_link_libraries(staq_${basename} PUBLIC gmp gmpxx)
        endif ()
    else ()
        if (${basename} STREQUAL "grid_synth" OR ${basename} STREQUAL "qasm_synth")
            continue()
        endif ()
        add_executable("staq_${basename}" ${filename})
    endif ()
    target_link_libraries(staq_${basename} PUBLIC libstaq)
    add_dependencies(tools staq_${basename})
    install(TARGETS staq_${basename} DESTINATION ${CMAKE_INSTALL_BINDIR})
endforeach ()
